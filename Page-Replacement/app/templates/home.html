<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Page Replacement</title>
    <link rel="stylesheet" href="styles.css">
    <script>
        let generatedFileData = '';

        function checkFileUpload() {
            const fileInput = document.getElementById('file');

            if (fileInput.files.length > 0) {
                seedInput.parentElement.style.display = 'none';
                processesInput.parentElement.style.display = 'none';
                operationsInput.parentElement.style.display = 'none';
                // Limpiar el archivo generado
                document.getElementById('generatedFile').value = '';
            } else {
                seedInput.parentElement.style.display = 'block';
                processesInput.parentElement.style.display = 'block';
                operationsInput.parentElement.style.display = 'block';
            }
        }

        async function generateFile() {
            const seed = document.getElementById('seed').value;
            const processes = document.getElementById('processes').value;
            const operations = document.getElementById('operations').value;

            const response = await fetch('/generate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ seed, processes, operations })
            });

            const data = await response.json();
            generatedFileData = data["data"]; // Guardar el archivo generado
            const downloadButton = document.getElementById('downloadButton');
            downloadButton.href = 'data:text/json;charset=utf-8,' + encodeURIComponent(generatedFileData);
            downloadButton.download = 'generated_file.txt';
            downloadButton.style.display = 'block';

            // Almacenar el archivo generado en el input hidden
            document.getElementById('generatedFile').value = generatedFileData;
        }

        function handleSubmit(event) {
            const fileInput = document.getElementById('file');
            const generatedFile = document.getElementById('generatedFile').value;
            
            // Si no se subi√≥ archivo, usamos el generado
            if (fileInput.files.length === 0 && generatedFile === '') {
                event.preventDefault();
                alert('Por favor, sube un archivo o genera uno.');
            }
        }
    </script>
</head>
<body>
    <h1>Page Replacement</h1>
    
    <form action="/simulation" method="post" enctype="multipart/form-data" onsubmit="handleSubmit(event)">
        <label for="file">Upload File:</label>
        <input type="file" id="file" name="file" onchange="checkFileUpload()"><br><br>

        <label for="seed">Seed:</label>
        <input type="text" id="seed" name="seed" required><br><br>

        <label for="processes">Quantity of Processes:</label>
        <input type="number" id="processes" name="processes"><br><br>
        
        <label for="operations">Quantity of Operations:</label>
        <input type="number" id="operations" name="operations"><br><br>

        <label for="algorithm">Algorithm:</label>
        <select id="algorithm" name="algorithm" required>
            <option value="FIFO">FIFO</option>
            <option value="SC">SC</option>
            <option value="MRU">MRU</option>
            <option value="RND">RND</option>
        </select><br><br>
        
        <button type="button" onclick="generateFile()">Generar</button>
        <a id="downloadButton" style="display:none;">Download</a>
        
        <!-- Campo oculto para almacenar el archivo generado -->
        <input type="hidden" id="generatedFile" name="generatedFile">
        
        <input type="submit" value="Start Simulation">
    </form>
</body>
</html>
